const boards =  [
    {
        "board_id": 1,
        "title": "아 제목 뭐로 할지 정말 고민이다ㅋㅋㅎㅋㅎㅋㅎㅋㅎㅋㅎㅋㅎㅋㅎㅋㅎㅋㅎㅋ",
        "writer_profile_url": "../resource/image/musk.jpeg",
        "writer_name": "일론 머스크",
        "created_at": "2024-04-15T12:24:34",
        "image_url" : "../resource/image/spacex.jpeg",
        "content" : "됐고 그 나 조만간 심심해서 로켙-트 하나 쏠라니까 심심하면 구경와라 ㅋㅋ 위치는 안알려줄거긴 한데 그냥 알아서 찾아오셈 한 번에 공개하면 재미 없으니까",
        "likes_count": 21,
        "views_count": 99,
        "comments_count": 33,
        "comments" : [
            {
                "comment_id" : 1,
                "comment_writer_profile" : "../resource/image/steve.jpeg", 
                "comment_writer_name" : "스티브 잡스",
                "comment_content" : "우주선에 사과 로고 하나 넣어주면 안됨?",
                "created_at" : "2024-04-16T12:24:11"
            },
            {
                "comment_id" : 2,
                "comment_writer_profile" : "../resource/image/profile2.jpeg",
                "comment_writer_name" : "무지",
                "comment_content" : "진짜 아무말이네",
                "created_at" : "2024-04-16T14:49:59"
            },
            {
                "comment_id" : 3,
                "comment_writer_profile" : "../resource/image/jaeyong.jpeg",
                "comment_writer_name" : "째용이형",
                "comment_content" : "아니 그러면 우리 회사 로고도 넣어주셈 밥 한끼 쏠게",
                "created_at" : "2024-04-20T11:42:33"
            }
        ]
    },
    {
        "board_id": 2,
        "title": "얘들아 나 사실 갤럭시 씀 ㅋㅋ",
        "writer_profile_url": "../resource/image/steve.jpeg",
        "writer_name": "스티브 잡스",
        "created_at": "2024-04-10T09:08:12",
        "image_url" : "../resource/image/steveG.jpeg",
        "content" : "야 이거 써보니까 좋더라. 나랑 콜라보할 생각 있는지 좀 궁금하네ㅋㅋㅋ 사실 내가 일부러 가격 높게 잡긴 했는데 이걸 따라오네 진짜 미치겠다. 이거 보고 찔리면 댓글 달아라.",
        "likes_count": 14004,
        "views_count": 330235,
        "comments_count": 2452,
        "comments" : [
            {
                "comment_id" : 1,
                "comment_writer_profile" : "../resource/image/jaeyong.jpeg",
                "comment_writer_name" : "째용이형",
                "comment_content" : "ㅋ",
                "created_at" : "2024-04-11T00:13:21"
            },
            {
                "comment_id" : 2,
                "comment_writer_profile" : "../resource/image/musk.jpeg",
                "comment_writer_name" : "일론 머스크",
                "comment_content" : "와드요",
                "created_at" : "2024-04-10T10:12:03"
            },
            {
                "comment_id" : 3,
                "comment_writer_profile" : "../resource/image/mawin.jpeg",
                "comment_writer_name" : "마윈",
                "comment_content" : "야 이거 월드컵보다 재밌겠는데",
                "created_at" : "2024-04-10T21:09:16"
            }
        ]
    },
    {
        "board_id": 3,
        "title": "깻잎으로 딱밤 때리기",
        "writer_profile_url": "../resource/image/profile2.jpeg",
        "writer_name": "무지",
        "created_at": "2024-04-15T12:24:34",
        "image_url" : "https://images.com/images/image.jpg",
        "content" : "무엇을 얘기할까요? 아무말이라면, 삶은 달걀입니다.",
        "likes_count": 12,
        "comments_count": 7,
        "views_count": 49,
        "comments" : [
            {
                "comment_id" : 1,
                "comment_writer_profile" : "../resource/image/profile2.jpeg",
                "comment_writer_name" : "더미 작성자 1",
                "comment_content" : "댓글 내용 1",
                "created_at" : "2021-01-02T00:00:00"
            },
            {
                "comment_id" : 2,
                "comment_writer_profile" : "../resource/image/profile2.jpeg",
                "comment_writer_name" : "더미 작성자 2",
                "comment_content" : "댓글 내용 2",
                "created_at" : "2021-01-02T00:00:00"
            },
            {
                "comment_id" : 3,
                "comment_writer_profile" : "../resource/image/profile2.jpeg",
                "comment_writer_name" : "더미 작성자 3",
                "comment_content" : "댓글 내용 3",
                "created_at" : "2021-01-02T00:00:00"
            }
        ]
    },
    {
        "board_id": 4,
        "title": "혼자 가위바위보 해서 이기는 방법 (진지하게 연구함)",
        "writer_profile_url": "../resource/image/musk.jpeg",
        "writer_name": "마윈",
        "created_at": "2024-01-01T00:13:57",
        "image_url" : "../resource/image/mawin.jpeg",
        "content" : "하... 진짜 나만 따라오라니까 가위바위보로 평생 먹고 살게 만들어줄게. 내가 지금 그러는거 안보임?",
        "likes_count": 532,
        "comments_count": 105,
        "views_count": 788,
        "comments" : [
            {
                "comment_id" : 1,
                "comment_writer_profile" : "../resource/image/profile2.jpeg",
                "comment_writer_name" : "더미 작성자 1",
                "comment_content" : "댓글 내용 1",
                "created_at" : "2021-01-02T00:00:00"
            },
            {
                "comment_id" : 2,
                "comment_writer_profile" : "../resource/image/profile2.jpeg",
                "comment_writer_name" : "더미 작성자 2",
                "comment_content" : "댓글 내용 2",
                "created_at" : "2021-01-02T00:00:00"
            },
            {
                "comment_id" : 3,
                "comment_writer_profile" : "../resource/image/profile2.jpeg",
                "comment_writer_name" : "더미 작성자 3",
                "comment_content" : "댓글 내용 3",
                "created_at" : "2021-01-02T00:00:00"
            }
        ]
    },
    {
        "board_id": 5,
        "title": "이번에 맥 살건데 추천좀",
        "writer_profile_url": "../resource/image/jaeyong.jpeg",
        "writer_name": "째용이형",
        "created_at": "2024-01-01T20:22:56",
        "image_url" : "../resource/image/youtube.png",
        "content" : "아니 잡스형 나 샤라웃 먼데ㅋㅋ 진짜 콜라보할 생각 있는거야? 사실 나도 앱등이라 이번에 맥북 하나 장만하려고 하는데 추천좀 해줘봐라",
        "likes_count": 1302,
        "comments_count": 2125,
        "views_count": 40105,
        "comments" : [
            {
                "comment_id" : 1,
                "comment_writer_profile" : "../resource/image/profile2.jpeg",
                "comment_writer_name" : "더미 작성자 1",
                "comment_content" : "댓글 내용 1",
                "created_at" : "2021-01-02T00:00:00"
            },
            {
                "comment_id" : 2,
                "comment_writer_profile" : "../resource/image/profile2.jpeg",
                "comment_writer_name" : "더미 작성자 2",
                "comment_content" : "댓글 내용 2",
                "created_at" : "2021-01-02T00:00:00"
            },
            {
                "comment_id" : 3,
                "comment_writer_profile" : "../resource/image/profile2.jpeg",
                "comment_writer_name" : "더미 작성자 3",
                "comment_content" : "댓글 내용 3",
                "created_at" : "2021-01-02T00:00:00"
            }
        ]
    }
];

// 더미 데이터가 5개 이므로 5부터 시작
let id = 5;

/**
 * 게시글 관련 로직
 */

// 게시글 등록
/*
* 유저 관련 데이터는 나중에 유저에 따라 다르게 보여줘야 함
*/
exports.save = async (req) => {
    try {
        const boardId = ++id;
        const board = {
            'board_id': boardId,
            'title': req.title,
            'writer_profile_url': '../resource/image/musk.jpeg',
            'writer_name': '일론 머스크',
            'image_url': req.image_url,
            'content': req.content,
            'likes_count': 0,
            'views_count': 0,
			'comments_count': 0,
            'created_at': req.created_at,
            'updated_at': req.updated_at,
            'comments': []
        }
        boards.push(board);
        return board;
    } catch (error) {
        throw error;
    }
}

// 게시글 목록 조회
exports.findAll = () => {
    return boards;
}

// 게시글 상세 조회
exports.findById = (boardId) => {
    const findBoard = boards.find(board => board['board_id'] == boardId);

    // 숫자가 아닌 경우 예외 처리 로직 필요
    
    // 존재하지 않는 게시글인 경우 
    if (findBoard === null || findBoard === undefined) {
        throw new Error('board_not_exist');
    }

    return findBoard;
}

// 게시글 수정
exports.updateBoard = (newBoard) => {
    const targetBoardId = newBoard.board_id;

    // 요청 유효성 검사
    const findBoard = this.findById(targetBoardId);
    const boardIndex = findBoard.board_id;

    // 존재하지 않는 게시글인 경우 
    if (findBoard === null || findBoard === undefined) {
        throw new Error('board_not_exist');
    }

    // 수정
    boards[boardIndex - 1].title = newBoard.title;
    boards[boardIndex - 1].content = newBoard.content;
    boards[boardIndex - 1].image_url = newBoard.image_url;

    return boards[boardIndex - 1];
}

// 게시글 삭제
exports.deleteById = (boardId) => {
    const findBoard = this.findById(boardId);

    // 숫자가 아닌 경우 예외 처리 로직 필요
    
    // 존재하지 않는 게시글인 경우 
    if (findBoard === null || findBoard === undefined) {
        throw new Error('board_not_exist');
    }

    boards.splice(boardId - 1, 1);
    console.log(boards);
}

/**
 * 댓글 관련 로직
 */

// 댓글 등록
exports.saveComment = (boardId, comment, createdAt) => {
    const findBoard = this.findById(boardId);
    const commentId = findBoard['comments'].length + 1;

    // 더미 유저
    const userId = 1;
    const nickname = "째용이형";
    const profileUrl = "../resource/image/jaeyong.jpeg"

    const commentData = {
        'board_id': boardId,
        'comment_id': commentId,
        'comment_content': comment,
        'comment_writer_name': '일론 머스크',
        'comment_writer_profile': '../resource/image/musk.jpeg',
        'created_at': createdAt
    }

    findBoard['comments'].push(commentData);

    return commentData;
}

// 댓글 수정
const findCommentById = (comments, commentId) => {
    const findComment = comments.find(comment => comment['comment_id'] == commentId);

    // 숫자가 아닌 경우 예외 처리 로직 필요

    // 존재하지 않는 댓글인 경우 
    if (findComment === null || findComment === undefined) {
        throw new Error('comment_not_exist');
    }

    return findComment;
}

exports.updateComment = (boardId, commentId, updateComment, updatedAt) => {
    const findBoard = this.findById(boardId);
    const comments = findBoard['comments'];
    const findComment = findCommentById(comments, commentId);
    findComment['comment_content'] = updateComment;
    findComment['updated_at'] = updatedAt;

    const commentData = {
        'board_id': boardId,
        'comment_id': commentId,
        'comment_content': updateComment,
        'comment_writer_name': findComment.comment_writer_name,
        'comment_writer_profile': findComment.comment_writer_profile,
        'created_at': findComment.createdAt,
        'updated_at': updatedAt
    }

    return commentData;
}

// 댓글 삭제
exports.deleteCommentById = (boardId, commentId) => {
    const findBoard = this.findById(boardId);
    if (findBoard == null || findBoard == undefined) {
        throw new Error('board_not_exist');
    }

    const comments = findBoard['comments'];
    const index = comments.findIndex(comment => comment.comment_id == commentId);

    if (index < 0 || index > comments.size) {
        throw new Error('comment_not_exist');
    }

    comments.splice(index, 1);
}